---
title: "PPCP analysis"
output:
  html_document:
    df_print: paged
---

The first step I am interested in is to perform basic ANVOA and then pairwise ANOVA test.
After that then normalizing and running a pca and ordinating to see if any of the PCs correspond with PPCPs

```{r message=FALSE, warning=FALSE}
library(dplyr)
library(factoextra)

raw_tab <- read.csv("ppcp_raw.csv")
header <- c("Sample_ID","1,7-Dimethylxanthine",	"Acetaminophen","Ampicillin","Azithromycin","Caffeine","Carbamazepine",	"Cefotaxime",	"Ciprofloxacin",	"Clarithromycin",	"Clinafloxacin",	"Codeine",	"Cotinine",	"Dehydronifedipine",	"Digoxigenin",	"Digoxin",	"Diltiazem","Diphenhydramine"	,"Enrofloxacin"	,"Erythromycin",	"Flumequine",	"Fluoxetine",	"Lincomycin",	"Lomefloxicin",	"Miconazole",	"Norfloxacin", "Norgestimate",	"Ofloxacin",	"Ormetoprim",	"Oxacillin",	"Penicillin-G",	"Penicillin-V",	"Penillic_Acid","Phenazone","Roxithromycin","Sarafloxacin",	"Sucralose",	"Sulfachlorpyridazine",	"Sulfadiazine",	"Sulfamerazine",	"Sulfamethazine",	"Sulfamethiazole",	"Sulfamethoxazole",	"Sulfanilamide", "Sulfathiazole",	"Thiabendazole", "Trimethoprim")
colnames(raw_tab) <- header
raw_tab['Site'] <- c(rep("NPS",3),rep("SLT",6), rep("SPR",6))
raw_tab['Local'] <- c(rep('UPST',6),rep('DWNS',3), rep('UPST',3),rep('DWNS',3))
col_order <- c("Sample_ID","Site","Local", "1,7-Dimethylxanthine",	"Acetaminophen","Ampicillin","Azithromycin","Caffeine","Carbamazepine",	"Cefotaxime",	"Ciprofloxacin",	"Clarithromycin",	"Clinafloxacin",	"Codeine",	"Cotinine",	"Dehydronifedipine",	"Digoxigenin",	"Digoxin",	"Diltiazem","Diphenhydramine"	,"Enrofloxacin"	,"Erythromycin",	"Flumequine",	"Fluoxetine",	"Lincomycin",	"Lomefloxicin",	"Miconazole",	"Norfloxacin", "Norgestimate",	"Ofloxacin",	"Ormetoprim",	"Oxacillin",	"Penicillin-G",	"Penicillin-V",	"Penillic_Acid","Phenazone","Roxithromycin","Sarafloxacin",	"Sucralose",	"Sulfachlorpyridazine",	"Sulfadiazine",	"Sulfamerazine",	"Sulfamethazine",	"Sulfamethiazole",	"Sulfamethoxazole",	"Sulfanilamide", "Sulfathiazole",	"Thiabendazole", "Trimethoprim")
raw_tab <- raw_tab[,col_order]
rownames(raw_tab) <- c("NPS1","NPS2","NPS3","SLT1","SLT2","SLT3","SLT6","SLT7","SLT8","SPR1","SPR2","SPR3","SPR6","SPR7","SPR8")

z_norm_tab <- as.data.frame(scale(raw_tab[,4:49], center=TRUE, scale=TRUE))

all_na <- function(x) any(!is.na(x))

z_norm_no_na <- z_norm_tab %>% 
  select_if(all_na) 

#z_norm_no_na <- cbind(raw_tab[,1:3], z_norm_no_na)


res.pca <- prcomp(z_norm_no_na,center = F, scale. = F)

fviz_eig(res.pca)

fviz_pca_ind(res.pca, col.ind = "cos2",repel = T, gradient.cols=c("#00AFBB","#E7B800","#FC4E07"))

fviz_pca_var(res.pca,
             col.var = "contrib",
             gradient.cols=c("#00AFBB","#E7B800","#FC4E07"),
             repel=T)
 
```
